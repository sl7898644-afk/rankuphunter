<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Solo Leveling Fitness - Hunter Training System</title>

<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600;800&family=Montserrat:wght@300;400;500;600&display=swap" rel="stylesheet">

<!-- Google Maps API with fallback -->
<script>
  // Fallback for Google Maps loading
  window.googleMapsLoaded = false;
  
  function initGoogleMaps() {
    window.googleMapsLoaded = true;
    console.log('Google Maps loaded successfully');
    // Initialize any maps that were waiting
    if (window.pendingMapInit) {
      window.pendingMapInit();
    }
  }
  
  function loadGoogleMaps() {
    const script = document.createElement('script');
    script.src = 'https://maps.googleapis.com/maps/api/js?key=AIzaSyAFQNYYCyN6a3fdaaLOung7B8f5wIoEvTA&libraries=geometry&callback=initGoogleMaps';
    script.onerror = function() {
      console.error('Failed to load Google Maps');
      showMapFallback();
    };
    
    // Add timeout fallback
    setTimeout(() => {
      if (!window.googleMapsLoaded) {
        console.log('Google Maps loading timeout - showing fallback');
        showMapFallback();
      }
    }, 8000); // 8 second timeout
    
    document.head.appendChild(script);
  }
  
  // Load Google Maps
  loadGoogleMaps();
</script>

<style>
:root {
  --primary-dark: #0a0a1a;
  --secondary-dark: #1a1a2e;
  --accent-blue: #00e5ff;
  --accent-purple: #bf00ff;
  --accent-red: #ff4757;
  --accent-gold: #ffd700;
  --card-bg: rgba(255, 255, 255, 0.05);
  --border-glow: 0 0 15px rgba(0, 229, 255, 0.5);
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  font-family: 'Montserrat', sans-serif;
}

body {
  background: linear-gradient(135deg, var(--primary-dark) 0%, var(--secondary-dark) 50%, #16213e 100%);
  color: white;
  min-height: 100vh;
  overflow-x: hidden;
  background-attachment: fixed;
}

/* Header */
.header {
  background: rgba(0, 0, 0, 0.8);
  padding: 20px;
  border-bottom: 2px solid var(--accent-blue);
  box-shadow: var(--border-glow);
  position: sticky;
  top: 0;
  z-index: 100;
}

.nav-container {
  max-width: 1400px;
  margin: 0 auto;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.logo {
  font-family: 'Orbitron', sans-serif;
  font-size: 28px;
  font-weight: 800;
  background: linear-gradient(90deg, var(--accent-blue), var(--accent-purple));
  -webkit-background-clip: text;
  background-clip: text;
  -webkit-text-fill-color: transparent;
  letter-spacing: 2px;
}

.user-panel {
  display: flex;
  align-items: center;
  gap: 20px;
}

.profile-section {
  display: flex;
  align-items: center;
  gap: 15px;
}

.profile-pic {
  width: 50px;
  height: 50px;
  border-radius: 50%;
  border: 2px solid var(--accent-blue);
  background: linear-gradient(45deg, var(--accent-blue), var(--accent-purple));
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 20px;
  cursor: pointer;
  transition: all 0.3s;
}

.profile-pic:hover {
  transform: scale(1.1);
  box-shadow: 0 0 20px var(--accent-blue);
}

.rank-badge {
  padding: 5px 15px;
  border-radius: 20px;
  font-size: 14px;
  font-weight: 600;
  background: linear-gradient(45deg, var(--accent-gold), #ffa500);
  color: #000;
  box-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
}

.nav-buttons button {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid var(--accent-blue);
  color: var(--accent-blue);
  padding: 10px 20px;
  border-radius: 25px;
  cursor: pointer;
  transition: all 0.3s;
  font-weight: 500;
}

.nav-buttons button:hover {
  background: var(--accent-blue);
  color: #000;
  transform: translateY(-2px);
  box-shadow: 0 5px 15px rgba(0, 229, 255, 0.4);
}

/* Main Content */
.container {
  max-width: 1400px;
  margin: 30px auto;
  padding: 0 20px;
}

.section-title {
  font-family: 'Orbitron', sans-serif;
  font-size: 32px;
  text-align: center;
  margin-bottom: 30px;
  background: linear-gradient(90deg, var(--accent-blue), var(--accent-purple));
  -webkit-background-clip: text;
  background-clip: text;
  -webkit-text-fill-color: transparent;
  text-shadow: 0 0 20px rgba(0, 229, 255, 0.3);
}

/* Dashboard Grid */
.dashboard-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
  gap: 25px;
  margin-bottom: 40px;
}

/* Cards */
.card {
  background: var(--card-bg);
  border: 1px solid rgba(0, 229, 255, 0.3);
  border-radius: 15px;
  padding: 25px;
  backdrop-filter: blur(10px);
  transition: all 0.3s;
  position: relative;
  overflow: hidden;
}

.card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 3px;
  background: linear-gradient(90deg, var(--accent-blue), var(--accent-purple));
}

.card:hover {
  transform: translateY(-5px);
  box-shadow: var(--border-glow), 0 10px 30px rgba(0, 0, 0, 0.5);
  border-color: var(--accent-blue);
}

.card-header {
  display: flex;
  align-items: center;
  margin-bottom: 20px;
  padding-bottom: 15px;
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.card-icon {
  width: 50px;
  height: 50px;
  background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  margin-right: 15px;
  font-size: 24px;
}

.card-title {
  font-family: 'Orbitron', sans-serif;
  font-size: 22px;
  font-weight: 600;
  color: var(--accent-blue);
}

/* Stats Display */
.stat-value {
  font-size: 42px;
  font-weight: 800;
  font-family: 'Orbitron', sans-serif;
  background: linear-gradient(90deg, var(--accent-blue), var(--accent-purple));
  -webkit-background-clip: text;
  background-clip: text;
  -webkit-text-fill-color: transparent;
  margin: 15px 0;
  text-align: center;
}

.stat-label {
  color: #aaa;
  font-size: 16px;
  text-transform: uppercase;
  letter-spacing: 1px;
  text-align: center;
  margin-bottom: 15px;
}

.progress-container {
  margin: 20px 0;
}

.progress-bar {
  height: 12px;
  background: rgba(255, 255, 255, 0.1);
  border-radius: 6px;
  overflow: hidden;
  margin-bottom: 10px;
}

.progress-fill {
  height: 100%;
  background: linear-gradient(90deg, var(--accent-blue), var(--accent-purple));
  border-radius: 6px;
  transition: width 0.5s ease;
  position: relative;
}

.progress-fill::after {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
  animation: shine 2s infinite;
}

@keyframes shine {
  0% { transform: translateX(-100%); }
  100% { transform: translateX(100%); }
}

/* Training Section */
.training-section {
  grid-column: 1 / -1;
  margin-top: 30px;
}

.day-selector {
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
  gap: 10px;
  margin-bottom: 30px;
}

.day-btn {
  padding: 12px 20px;
  background: rgba(255, 255, 255, 0.1);
  border: 2px solid rgba(0, 229, 255, 0.3);
  color: var(--accent-blue);
  border-radius: 25px;
  cursor: pointer;
  transition: all 0.3s;
  font-weight: 500;
}

.day-btn:hover, .day-btn.active {
  background: var(--accent-blue);
  color: #000;
  transform: translateY(-3px);
  box-shadow: 0 5px 15px rgba(0, 229, 255, 0.4);
}

.exercises-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 20px;
  margin-top: 20px;
}

.exercise-card {
  background: rgba(26, 35, 68, 0.6);
  border: 2px solid rgba(0, 246, 255, 0.2);
  border-radius: 12px;
  padding: 20px;
  text-align: center;
  transition: all 0.3s;
}

.exercise-card:hover {
  border-color: var(--accent-blue);
  transform: scale(1.02);
  box-shadow: 0 0 20px rgba(0, 246, 255, 0.2);
}

.exercise-icon {
  font-size: 40px;
  margin-bottom: 15px;
}

.exercise-name {
  font-size: 20px;
  font-weight: 600;
  margin-bottom: 10px;
  color: var(--accent-blue);
}

.exercise-desc {
  font-size: 14px;
  color: #aaa;
  margin-bottom: 15px;
}

.sets-info {
  font-size: 16px;
  font-weight: 500;
  color: var(--accent-gold);
  margin-bottom: 15px;
}

.start-btn {
  background: linear-gradient(135deg, #00c851, #00e676);
  border: none;
  padding: 12px 25px;
  border-radius: 25px;
  color: white;
  font-weight: bold;
  cursor: pointer;
  transition: all 0.3s;
  width: 100%;
}

.start-btn:hover {
  transform: scale(1.05);
  box-shadow: 0 0 20px #00e676;
}

/* Leaderboard */
.leaderboard-section {
  grid-column: 1 / -1;
  margin-top: 40px;
}

.leaderboard-table {
  width: 100%;
  border-collapse: collapse;
  background: rgba(0, 0, 0, 0.3);
  border-radius: 15px;
  overflow: hidden;
}

.leaderboard-table th {
  background: linear-gradient(90deg, var(--accent-blue), var(--accent-purple));
  color: #000;
  padding: 15px;
  text-align: left;
  font-weight: 600;
}

.leaderboard-table td {
  padding: 15px;
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.leaderboard-table tr:hover {
  background: rgba(0, 229, 255, 0.1);
}

.rank-cell {
  font-weight: bold;
  color: var(--accent-gold);
  font-size: 18px;
}

/* Modal */
.modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.8);
  z-index: 1000;
  justify-content: center;
  align-items: center;
}

.modal-content {
  background: var(--secondary-dark);
  border: 2px solid var(--accent-blue);
  border-radius: 15px;
  padding: 30px;
  width: 90%;
  max-width: 500px;
  box-shadow: var(--border-glow);
  position: relative;
}

.close-modal {
  position: absolute;
  top: 15px;
  right: 15px;
  font-size: 24px;
  cursor: pointer;
  color: var(--accent-red);
}

/* Profile Upload */
.upload-area {
  border: 2px dashed var(--accent-blue);
  border-radius: 10px;
  padding: 30px;
  text-align: center;
  margin: 20px 0;
  cursor: pointer;
  transition: all 0.3s;
}

.upload-area:hover {
  background: rgba(0, 229, 255, 0.1);
}

.upload-preview {
  width: 120px;
  height: 120px;
  border-radius: 50%;
  border: 3px solid var(--accent-blue);
  margin: 0 auto 20px;
  background-size: cover;
  background-position: center;
}

/* Responsive */
@media (max-width: 768px) {
  .nav-container {
    flex-direction: column;
    gap: 15px;
    padding: 10px;
  }
  
  .dashboard-grid {
    grid-template-columns: 1fr;
    gap: 15px;
  }
  
  .exercises-grid {
    grid-template-columns: 1fr;
    gap: 15px;
  }
  
  .stat-value {
    font-size: 32px;
  }
  
  .section-title {
    font-size: 24px;
  }
  
  .card {
    padding: 20px;
  }
  
  .day-btn {
    padding: 10px 15px;
    font-size: 14px;
  }
  
  .exercise-card {
    padding: 15px;
    margin: 10px 5px;
  }
  
  .start-btn {
    padding: 10px 15px !important;
    font-size: 14px !important;
    margin: 8px 0;
  }
  
  .exercise-card button {
    width: 100% !important;
    margin: 5px 0;
  }
  
  .exercises-grid {
    gap: 10px;
  }
  
  .exercise-card {
    margin: 8px 0;
  }
  
  .start-btn {
    min-height: 44px; /* Touch-friendly size */
  }
  
  .day-btn {
    min-height: 40px;
    margin: 5px;
  }
}

@media (max-width: 480px) {
  .container {
    padding: 10px;
  }
  
  .header {
    padding: 15px;
  }
  
  .profile-pic {
    width: 40px;
    height: 40px;
  }
  
  .stat-value {
    font-size: 28px;
  }
  
  .card {
    padding: 15px;
  }
  
  .day-btn {
    padding: 8px 12px;
    font-size: 12px;
  }
}
</style>
</head>

<body>

<!-- Header -->
<div class="header">
  <div class="nav-container">
    <div class="logo">SOLO LEVELING FITNESS</div>
    <div class="user-panel">
      <div class="profile-section">
        <div class="profile-pic" onclick="openProfileModal()" id="profilePicture">üë§</div>
        <div>
          <div id="hunterName">HUNTER</div>
          <div class="rank-badge" id="currentRank">E-RANK</div>
        </div>
      </div>
      <div class="nav-buttons">
        <button onclick="logout()">LOGOUT</button>
        <button onclick="deleteAccount()" style="background: linear-gradient(135deg, var(--accent-red), #ff6b6b); margin-left: 10px;">DELETE ACCOUNT</button>
        <button onclick="toggleWorkoutTracker()" style="background: linear-gradient(135deg, var(--accent-green), #4CAF50); margin-left: 10px;">WORKOUT TRACKER</button>
      </div>
    </div>
  </div>
</div>

<!-- Main Content -->
<div class="container">
  <h1 class="section-title">HUNTER TRAINING DASHBOARD</h1>
  
  <div class="dashboard-grid">
    <!-- Level Card -->
    <div class="card">
      <div class="card-header">
        <div class="card-icon">‚öîÔ∏è</div>
        <div class="card-title">HUNTER LEVEL</div>
      </div>
      <div class="stat-value" id="levelDisplay">1</div>
      <div class="stat-label">CURRENT LEVEL</div>
      <div class="progress-container">
        <div class="progress-bar">
          <div class="progress-fill" id="expProgress" style="width: 0%"></div>
        </div>
        <div style="text-align: center; color: #aaa;">
          EXP: <span id="currentExp">0</span>/<span id="nextLevelExp">100</span>
        </div>
      </div>
    </div>

    <!-- Rank Card -->
    <div class="card">
      <div class="card-header">
        <div class="card-icon">üèÜ</div>
        <div class="card-title">HUNTER RANK</div>
      </div>
      <div class="stat-value" id="rankDisplay">E-RANK</div>
      <div class="stat-label">CURRENT RANK</div>
      <div style="text-align: center; color: var(--accent-gold); font-size: 14px; margin-top: 15px;">
        Progress to next rank: <span id="rankProgress">0</span>%
      </div>
    </div>

    <!-- Power Score Card -->
    <div class="card">
      <div class="card-header">
        <div class="card-icon">‚ö°</div>
        <div class="card-title">POWER SCORE</div>
      </div>
      <div class="stat-value" id="powerScore">100</div>
      <div class="stat-label">TOTAL XP</div>
      <div style="text-align: center; color: #aaa; font-size: 14px; margin-top: 15px;">
        Workouts Completed: <span id="workoutsCompleted">0</span>
      </div>
    </div>

    <!-- Streak Card -->
    <div class="card">
      <div class="card-header">
        <div class="card-icon">üî•</div>
        <div class="card-title">TRAINING STREAK</div>
      </div>
      <div class="stat-value" id="streakCount">0</div>
      <div class="stat-label">DAYS IN A ROW</div>
      <div style="text-align: center; color: #aaa; font-size: 14px; margin-top: 15px;">
        Last trained: <span id="lastTrainedDate">Never</span>
      </div>
    </div>
  </div>

  <!-- Training Section -->
  <div class="card training-section">
    <div class="card-header">
      <div class="card-icon">üèãÔ∏è</div>
      <div class="card-title">7-DAY TRAINING CYCLE</div>
    </div>
    
    <div class="day-selector" id="daySelector">
      <!-- Days will be populated by JavaScript -->
    </div>
    
    <div style="text-align: center; margin: 20px 0;">
      <button onclick="startCompleteTraining()" style="background: linear-gradient(135deg, var(--accent-red), #ff6b6b); border: none; padding: 15px 30px; border-radius: 30px; color: white; font-weight: bold; cursor: pointer; font-size: 18px; box-shadow: 0 0 20px rgba(255, 71, 87, 0.5);">COMPLETE TRAINING (10 XP)</button>
      <div id="trainingLimitInfo" style="margin-top: 10px; color: #aaa; font-size: 14px;"></div>
    </div>
    
    <div class="exercises-grid" id="exercisesContainer">
      <!-- Exercises will be populated by JavaScript -->
    </div>
  </div>

  <!-- Leaderboard Section -->
  <div class="card leaderboard-section">
    <div class="card-header">
      <div class="card-icon">üèÖ</div>
      <div class="card-title">GLOBAL LEADERBOARD</div>
    </div>
    
    <table class="leaderboard-table">
      <thead>
        <tr>
          <th>Rank</th>
          <th>Hunter</th>
          <th>Rank</th>
          <th>Power Score</th>
          <th>Workouts</th>
        </tr>
      </thead>
      <tbody id="leaderboardBody">
        <!-- Leaderboard will be populated by JavaScript -->
      </tbody>
    </table>
  </div>
</div>

<!-- Profile Modal -->
<div class="modal" id="profileModal">
  <div class="modal-content">
    <span class="close-modal" onclick="closeProfileModal()">&times;</span>
    <h2 style="text-align: center; margin-bottom: 20px; color: var(--accent-blue);">PROFILE SETUP</h2>
    
    <div class="upload-area" onclick="document.getElementById('profileUpload').click()">
      <div class="upload-preview" id="uploadPreview">üë§</div>
      <p>Click to upload profile picture</p>
      <p style="font-size: 12px; color: #aaa;">Required for leaderboard visibility</p>
      <input type="file" id="profileUpload" accept="image/*" style="display: none;" onchange="previewImage(event)">
    </div>
    
    <div style="margin: 20px 0;">
      <label style="display: block; margin-bottom: 8px; color: var(--accent-blue);">Hunter Name:</label>
      <input type="text" id="hunterNameInput" placeholder="Enter your hunter name" style="width: 100%; padding: 12px; background: rgba(255,255,255,0.1); border: 1px solid var(--accent-blue); border-radius: 8px; color: white;">
    </div>
    
    <button onclick="saveProfile()" style="width: 100%; padding: 15px; background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple)); border: none; border-radius: 8px; color: white; font-weight: bold; cursor: pointer; margin-top: 20px;">SAVE PROFILE</button>
  </div>
</div>

<!-- Workout Tracker Modal -->
<div class="modal" id="workoutTrackerModal" style="display: none;">
  <div class="modal-content" style="max-width: 800px; width: 90%;">
    <span class="close-modal" onclick="toggleWorkoutTracker()">&times;</span>
    <h2 style="text-align: center; margin-bottom: 20px; color: var(--accent-green);">üèÉ‚Äç‚ôÇÔ∏è Workout Tracker</h2>
    
    <div style="display: flex; gap: 20px; margin-bottom: 20px;">
      <div style="flex: 1; background: rgba(0,0,0,0.3); padding: 15px; border-radius: 10px;">
        <h3>Current Session</h3>
        <div style="font-size: 18px; margin: 10px 0;">
          <div>‚è±Ô∏è Time: <span id="timer">00:00:00</span></div>
          <div>üèÉ Distance: <span id="distance">0.00</span> km</div>
          <div>üî• Calories: <span id="calories">0</span></div>
          <div>‚ö° Pace: <span id="pace">0:00</span>/km</div>
          <div>üë£ Steps: <span id="steps">0</span></div>
        </div>
      </div>
      
      <div style="flex: 1; background: rgba(0,0,0,0.3); padding: 15px; border-radius: 10px;">
        <h3>Controls</h3>
        <div style="display: flex; gap: 10px; margin-top: 15px;">
          <button id="startBtn" onclick="startWorkout()" style="flex: 1; background: linear-gradient(135deg, #4CAF50, #45a049); padding: 12px; border: none; border-radius: 8px; color: white; font-weight: bold;">START</button>
          <button id="pauseBtn" onclick="pauseWorkout()" style="flex: 1; background: linear-gradient(135deg, #ff9800, #f57c00); padding: 12px; border: none; border-radius: 8px; color: white; font-weight: bold; display: none;">PAUSE</button>
          <button id="stopBtn" onclick="stopWorkout()" style="flex: 1; background: linear-gradient(135deg, #f44336, #d32f2f); padding: 12px; border: none; border-radius: 8px; color: white; font-weight: bold; display: none;">STOP</button>
        </div>
        <div style="margin-top: 15px; text-align: center;">
          <button id="getLocationBtn" onclick="getLocationPermission()" style="background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple)); padding: 8px 15px; border: none; border-radius: 5px; color: white; font-size: 14px;">Enable Location</button>
        </div>
      </div>
    </div>
    
    <!-- Google Map Container -->
    <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 10px; margin-bottom: 20px;">
      <h3>üìç Google Maps Route</h3>
      <div id="googleMap" style="height: 300px; background: #2a2a2a; border-radius: 8px; position: relative; overflow: hidden;">
        <div id="mapPlaceholder" style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; color: #777; font-size: 16px;">
          üìç Enable location to view Google Maps
        </div>
        <div id="googleMapContainer" style="width: 100%; height: 100%; display: none;"></div>
      </div>
    </div>
    
    <!-- Previous Sessions -->
    <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 10px;">
      <h3>üìä Previous Sessions</h3>
      <div id="previousSessions" style="max-height: 200px; overflow-y: auto;">
        <div style="text-align: center; color: #777; padding: 20px;">No previous sessions recorded</div>
      </div>
    </div>
  </div>
</div>



<!-- Workout Tracker Modal -->
<div id="workoutTrackerModal" class="modal" style="display: none;">
  <div class="modal-content" style="max-width: 800px; width: 90%;">
    <span class="close" onclick="toggleWorkoutTracker()">&times;</span>
    <h2 style="text-align: center; margin-bottom: 20px;">üèÉ‚Äç‚ôÇÔ∏è Workout Tracker</h2>
    
    <div style="display: flex; gap: 20px; margin-bottom: 20px;">
      <div style="flex: 1; background: rgba(0,0,0,0.3); padding: 15px; border-radius: 10px;">
        <h3>Current Session</h3>
        <div style="font-size: 18px; margin: 10px 0;">
          <div>‚è±Ô∏è Time: <span id="timer">00:00:00</span></div>
          <div>üèÉ Distance: <span id="distance">0.00</span> km</div>
          <div>üî• Calories: <span id="calories">0</span></div>
          <div>‚ö° Pace: <span id="pace">0:00</span>/km</div>
        </div>
      </div>
      
      <div style="flex: 1; background: rgba(0,0,0,0.3); padding: 15px; border-radius: 10px;">
        <h3>Controls</h3>
        <div style="display: flex; gap: 10px; margin-top: 15px;">
          <button id="startBtn" onclick="startWorkout()" style="flex: 1; background: linear-gradient(135deg, #4CAF50, #45a049); padding: 12px; border: none; border-radius: 8px; color: white; font-weight: bold;">START</button>
          <button id="pauseBtn" onclick="pauseWorkout()" style="flex: 1; background: linear-gradient(135deg, #ff9800, #f57c00); padding: 12px; border: none; border-radius: 8px; color: white; font-weight: bold; display: none;">PAUSE</button>
          <button id="stopBtn" onclick="stopWorkout()" style="flex: 1; background: linear-gradient(135deg, #f44336, #d32f2f); padding: 12px; border: none; border-radius: 8px; color: white; font-weight: bold; display: none;">STOP</button>
        </div>
      </div>
    </div>
    
    <!-- Map Container -->
    <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 10px; margin-bottom: 20px;">
      <h3>üìç Route Map</h3>
      <div id="mapContainer" style="height: 300px; background: #2a2a2a; border-radius: 8px; position: relative; overflow: hidden;">
        <div id="routeMap" style="width: 100%; height: 100%; position: relative;">
          <!-- Map will be generated here -->
          <div style="position: absolute; top: 10px; left: 10px; background: rgba(0,0,0,0.7); padding: 8px; border-radius: 5px; color: white; font-size: 12px;">
            üó∫Ô∏è Professional Route Tracking
          </div>
        </div>
      </div>
    </div>
    
    <!-- Previous Sessions -->
    <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 10px;">
      <h3>üìä Previous Sessions</h3>
      <div id="previousSessions" style="max-height: 200px; overflow-y: auto;">
        <div style="text-align: center; color: #777; padding: 20px;">No previous sessions recorded</div>
      </div>
    </div>
  </div>
</div>

<script>
// Training data for 7-day cycle
const trainingSchedule = {
  1: {
    name: "BEGINNER STRENGTH",
    exercises: [
      { name: "Push-ups", sets: "3 x 10", icon: "üí™" },
      { name: "Squats", sets: "3 x 15", icon: "ü¶µ" },
      { name: "Sit-ups", sets: "3 x 20", icon: "üßò" },
      { name: "Jumping Jacks", sets: "3 x 30", icon: "üï∫" },
      { name: "Plank", sets: "3 x 30s", icon: "üßò" },
      { name: "Running", sets: "10-15 min", icon: "üèÉ" }
    ]
  },
  2: {
    name: "CORE & ABS",
    exercises: [
      { name: "Sit-ups", sets: "4 x 15", icon: "üßò" },
      { name: "Leg Raises", sets: "3 x 12", icon: "ü¶µ" },
      { name: "Mountain Climbers", sets: "3 x 20", icon: "üèîÔ∏è" },
      { name: "Russian Twists", sets: "3 x 20", icon: "üå™Ô∏è" },
      { name: "Plank Hold", sets: "3 x 45s", icon: "üßò" },
      { name: "High Knees", sets: "3 x 30", icon: "üî•" }
    ]
  },
  3: {
    name: "LOWER BODY (LEG DAY)",
    exercises: [
      { name: "Squats", sets: "4 x 12", icon: "ü¶µ" },
      { name: "Lunges", sets: "3 x 10 each leg", icon: "üö∂" },
      { name: "Wall Sit", sets: "3 x 45s", icon: "üß±" },
      { name: "Calf Raises", sets: "3 x 20", icon: "ü¶µ" },
      { name: "Jump Squats", sets: "3 x 15", icon: "ü¶ò" },
      { name: "Running", sets: "Sprint/Normal", icon: "üèÉ" }
    ]
  },
  4: {
    name: "UPPER BODY",
    exercises: [
      { name: "Push-ups", sets: "4 x 12", icon: "üí™" },
      { name: "Diamond Push-ups", sets: "3 x 8", icon: "üíé" },
      { name: "Wide Push-ups", sets: "3 x 10", icon: "üëê" },
      { name: "Arm Circles", sets: "3 x 30", icon: "üåÄ" },
      { name: "Shoulder Taps", sets: "3 x 20", icon: "üëã" },
      { name: "Plank to Push-up", sets: "3 x 10", icon: "üîÑ" }
    ]
  },
  5: {
    name: "CARDIO & ENDURANCE",
    exercises: [
      { name: "Running", sets: "20-30 min", icon: "üèÉ" },
      { name: "Jump Rope", sets: "3 x 2 min", icon: "ü™¢" },
      { name: "Burpees", sets: "3 x 15", icon: "üí•" },
      { name: "Jumping Jacks", sets: "3 x 40", icon: "üï∫" },
      { name: "High Knees", sets: "3 x 45", icon: "üî•" },
      { name: "Mountain Climbers", sets: "3 x 30", icon: "üèîÔ∏è" }
    ]
  },
  6: {
    name: "FULL BODY",
    exercises: [
      { name: "Push-ups", sets: "4 x 15", icon: "üí™" },
      { name: "Squats", sets: "4 x 20", icon: "ü¶µ" },
      { name: "Sit-ups", sets: "4 x 25", icon: "üßò" },
      { name: "Burpees", sets: "3 x 20", icon: "üí•" },
      { name: "Lunges", sets: "3 x 15 each leg", icon: "üö∂" },
      { name: "Plank", sets: "3 x 60s", icon: "üßò" }
    ]
  },
  7: {
    name: "HUNTER TEST / CHALLENGE DAY",
    exercises: [
      { name: "Max Push-ups", sets: "1 minute", icon: "‚è±Ô∏è" },
      { name: "Max Squats", sets: "1 minute", icon: "‚è±Ô∏è" },
      { name: "Max Sit-ups", sets: "1 minute", icon: "‚è±Ô∏è" },
      { name: "Running", sets: "1-2 km", icon: "üèÉ" },
      { name: "Plank Hold", sets: "Maximum time", icon: "‚è±Ô∏è" },
      { name: "Burpees", sets: "20-30 reps", icon: "üí•" }
    ]
  }
};

// Rank progression system
const ranks = [
  { name: "E-RANK", minXP: 0, multiplier: 1 },
  { name: "D-RANK", minXP: 500, multiplier: 1.2 },
  { name: "C-RANK", minXP: 1500, multiplier: 1.5 },
  { name: "B-RANK", minXP: 3000, multiplier: 2 },
  { name: "A-RANK", minXP: 5000, multiplier: 2.5 },
  { name: "S-RANK", minXP: 8000, multiplier: 3 },
  { name: "SS-RANK", minXP: 12000, multiplier: 4 },
  { name: "NATIONAL LEVEL", minXP: 20000, multiplier: 5 }
];

// Initialize the application
function initApp() {
  console.log('=== APP INITIALIZATION STARTED ===');
  console.log('Current localStorage users:', localStorage.getItem('users'));
  console.log('Current currentUser:', localStorage.getItem('currentUser'));
  
  loadUserData();
  populateDaySelector();
  // Load leaderboard after a small delay to ensure data is ready
  setTimeout(() => {
    loadLeaderboard();
  }, 300);
  checkProfileCompletion();
  updateTrainingLimitInfo();
  initWorkoutTracker(); // Initialize workout tracker
  
  console.log('=== APP INITIALIZATION COMPLETED ===');
}

// Load user data
function loadUserData() {
  let currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
  
  if (!currentUser.email) {
    // Redirect to login if not logged in
    window.location.href = 'index.html';
    return;
  }
  
  // Normalize data: ensure all fields are present
  if (currentUser.exp !== undefined && currentUser.xp === undefined) {
    currentUser.xp = currentUser.exp;
  }
  if (currentUser.expToNextLevel !== undefined && currentUser.nextLevelExp === undefined) {
    currentUser.nextLevelExp = currentUser.expToNextLevel;
  }
  if (currentUser.trainingCount !== undefined && currentUser.workoutsCompleted === undefined) {
    currentUser.workoutsCompleted = currentUser.trainingCount;
  }
  if (currentUser.name !== undefined && currentUser.hunterName === undefined) {
    currentUser.hunterName = currentUser.name;
  }
  if (currentUser.profilePhoto !== undefined && currentUser.profilePic === undefined) {
    currentUser.profilePic = currentUser.profilePhoto;
  }
  
  // Update UI with user data - make sure to use the correct values
  document.getElementById('hunterName').textContent = currentUser.hunterName || currentUser.name || 'HUNTER';
  document.getElementById('currentRank').textContent = getRankByXP(currentUser.xp || 0);
  document.getElementById('levelDisplay').textContent = currentUser.level || 1;
  document.getElementById('rankDisplay').textContent = getRankByXP(currentUser.xp || 0);
  document.getElementById('powerScore').textContent = currentUser.xp || 0;  // Ensure this shows actual XP
  document.getElementById('workoutsCompleted').textContent = currentUser.workoutsCompleted || currentUser.trainingCount || 0;  // Ensure this shows actual workouts
  document.getElementById('streakCount').textContent = currentUser.streak || 0;
  
  // Update progress bars
  const currentXP = currentUser.xp || 0;
  const currentRank = getCurrentRankInfo(currentXP);
  const nextRank = getNextRankInfo(currentXP);
  
  if (nextRank) {
    const progressPercent = ((currentXP - currentRank.minXP) / (nextRank.minXP - currentRank.minXP)) * 100;
    document.getElementById('rankProgress').textContent = Math.min(100, Math.round(progressPercent));
  }
  
  // Update EXP progress
  const level = currentUser.level || 1;
  const expToNext = currentUser.nextLevelExp || level * 100;
  const currentExp = currentUser.currentExp || 0;
  const expPercent = (currentExp / expToNext) * 100;
  
  document.getElementById('expProgress').style.width = expPercent + '%';
  document.getElementById('currentExp').textContent = currentExp;
  document.getElementById('nextLevelExp').textContent = expToNext;
  
  // Update last trained date
  if (currentUser.lastTrained) {
    const lastTrained = new Date(currentUser.lastTrained);
    document.getElementById('lastTrainedDate').textContent = lastTrained.toLocaleDateString();
  }
  
  // Update profile picture - ensure it's properly loaded
  const profilePicElement = document.getElementById('profilePicture');
  if (currentUser.profilePic && currentUser.profilePic.length > 0 && 
      currentUser.profilePic !== 'undefined' && currentUser.profilePic !== 'null' &&
      currentUser.profilePic !== 'none') {
    profilePicElement.style.backgroundImage = `url('${currentUser.profilePic}')`;
    profilePicElement.style.backgroundSize = 'cover';
    profilePicElement.style.backgroundPosition = 'center';
    profilePicElement.textContent = '';
  } else if (currentUser.profilePhoto && currentUser.profilePhoto.length > 0) {
    // Handle legacy profilePhoto field from signup page
    profilePicElement.style.backgroundImage = `url('${currentUser.profilePhoto}')`;
    profilePicElement.style.backgroundSize = 'cover';
    profilePicElement.style.backgroundPosition = 'center';
    profilePicElement.textContent = '';
  }
  
  console.log('Loaded user data:', currentUser); // Debug log
  
  // Refresh the leaderboard to show updated data
  loadLeaderboard();
}

// Get rank by XP
function getRankByXP(xp) {
  for (let i = ranks.length - 1; i >= 0; i--) {
    if (xp >= ranks[i].minXP) {
      return ranks[i].name;
    }
  }
  return "E-RANK";
}

// Get current rank info
function getCurrentRankInfo(xp) {
  for (let i = ranks.length - 1; i >= 0; i--) {
    if (xp >= ranks[i].minXP) {
      return ranks[i];
    }
  }
  return ranks[0];
}

// Get next rank info
function getNextRankInfo(xp) {
  for (let i = 0; i < ranks.length; i++) {
    if (xp < ranks[i].minXP) {
      return ranks[i];
    }
  }
  return null;
}

// Populate day selector
function populateDaySelector() {
  const container = document.getElementById('daySelector');
  container.innerHTML = '';
  
  for (let day = 1; day <= 7; day++) {
    const btn = document.createElement('button');
    btn.className = 'day-btn';
    btn.textContent = `DAY ${day}`;
    btn.onclick = () => selectDay(day);
    container.appendChild(btn);
  }
  
  // Select current day by default
  const today = new Date().getDay() || 7; // Sunday = 0, convert to 7
  selectDay(today);
}

// Select training day
function selectDay(day) {
  // Update active button
  document.querySelectorAll('.day-btn').forEach(btn => btn.classList.remove('active'));
  event.target.classList.add('active');
  
  // Display exercises for selected day
  displayExercises(day);
}

// Display exercises for selected day
function displayExercises(day) {
  const container = document.getElementById('exercisesContainer');
  const dayData = trainingSchedule[day];
  
  container.innerHTML = `<h3 style="grid-column: 1/-1; text-align: center; color: var(--accent-blue); margin-bottom: 20px;">${dayData.name}</h3>`;
  
  dayData.exercises.forEach((exercise, index) => {
    const exerciseCard = document.createElement('div');
    exerciseCard.className = 'exercise-card';
    exerciseCard.innerHTML = `
      <div class="exercise-icon">${exercise.icon}</div>
      <div class="exercise-name">${exercise.name}</div>
      <div class="exercise-desc">${day === 7 ? 'Challenge Mode' : 'Standard Sets'}</div>
      <div class="sets-info">${exercise.sets}</div>
      <button class="start-btn" onclick="startExercise(${day}, ${index})">START EXERCISE</button>
      <button style="background: rgba(0, 229, 255, 0.2); border: 1px solid var(--accent-blue); color: var(--accent-blue); padding: 8px 15px; border-radius: 20px; cursor: pointer; margin-top: 10px; font-size: 12px;" onclick="showExerciseGuide('${exercise.name}')">HOW TO DO?</button>
    `;
    container.appendChild(exerciseCard);
  });
}

// Start exercise timer
function startExercise(day, exerciseIndex) {
  const exercise = trainingSchedule[day].exercises[exerciseIndex];
  const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
  const currentRank = getCurrentRankInfo(currentUser.xp || 0);
  
  // Calculate adjusted sets based on rank
  let setsInfo = exercise.sets;
  if (currentRank.multiplier > 1) {
    // Increase intensity for higher ranks
    setsInfo = adjustSetsForRank(exercise.sets, currentRank.multiplier);
  }
  
  alert(`Starting: ${exercise.name}\nSets: ${setsInfo}\nRank Bonus Applied: ${currentRank.name}`);
  
  // Simulate workout completion
  setTimeout(() => {
    completeWorkout(day, exerciseIndex);
  }, 3000);
}

// Adjust sets based on rank
function adjustSetsForRank(sets, multiplier) {
  if (sets.includes('x')) {
    const parts = sets.split('x');
    const setsCount = parseInt(parts[0]);
    const reps = parts[1].trim();
    
    if (reps.includes('min') || reps.includes('km') || reps.includes('time')) {
      return sets; // Don't adjust time-based exercises
    }
    
    const newReps = Math.ceil(parseInt(reps.replace(/\D/g, '')) * multiplier);
    return `${setsCount} x ${newReps}`;
  }
  return sets;
}

// Complete workout
function completeWorkout(day, exerciseIndex) {
  const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
  const users = JSON.parse(localStorage.getItem('users') || '[]');
  
  // Find user in users array
  const userIndex = users.findIndex(u => u.email === currentUser.email);
  if (userIndex === -1) return;
  
  // Check training limit for A-Rank and below
  const currentRank = getCurrentRankInfo(currentUser.xp || 0);
  const rankIndex = ranks.findIndex(rank => rank.name === currentRank.name);
  const aRankIndex = ranks.findIndex(rank => rank.name === 'A-RANK');
  
  if (rankIndex <= aRankIndex) { // A-Rank and below
    const today = new Date().toDateString();
    const todayTrainings = users[userIndex]?.todayTrainings || [];
    
    if (todayTrainings.includes(today) && todayTrainings.filter(date => date === today).length >= 2) {
      alert('You have reached your daily training limit (2 trainings per day).\nUpgrade to B-Rank or higher for unlimited training!');
      return;
    }
  }
  
  // Award XP based on exercise difficulty
  const xpGain = day === 7 ? 50 : 20; // More XP for challenge day
  users[userIndex].xp = (users[userIndex].xp || 0) + xpGain;  // Changed from || 100 to || 0
  
  // Update workouts completed
  users[userIndex].workoutsCompleted = (users[userIndex].workoutsCompleted || 0) + 1;
  
  // Update streak and daily training count
  const today = new Date().toDateString();
  const lastTrained = users[userIndex].lastTrainedDate;
  
  // Initialize todayTrainings array if not exists
  if (!users[userIndex].todayTrainings) {
    users[userIndex].todayTrainings = [];
  }
  
  // Reset daily trainings if it's a new day
  if (!lastTrained || new Date(lastTrained).toDateString() !== today) {
    users[userIndex].todayTrainings = users[userIndex].todayTrainings.filter(date => date !== today);
  }
  
  // Add today's training
  users[userIndex].todayTrainings.push(today);
  
  if (lastTrained && new Date(lastTrained).toDateString() === new Date(Date.now() - 86400000).toDateString()) {
    // Consecutive day
    users[userIndex].streak = (users[userIndex].streak || 0) + 1;
  } else if (!lastTrained || new Date(lastTrained).toDateString() !== today) {
    // New day
    users[userIndex].streak = (users[userIndex].streak || 0) + 1;
  }
  
  users[userIndex].lastTrainedDate = today;
  users[userIndex].lastTrained = new Date().toISOString();
  
  // Check for level up
  const level = users[userIndex].level || 1;
  const currentExp = users[userIndex].currentExp || 0;
  const expToNext = level * 100;
  
  if (currentExp + xpGain >= expToNext) {
    users[userIndex].level = level + 1;
    users[userIndex].currentExp = (currentExp + xpGain) - expToNext;
    alert(`üéâ LEVEL UP! You are now Level ${users[userIndex].level}!`);
  } else {
    users[userIndex].currentExp = currentExp + xpGain;
  }
  
  // Ensure data normalization
  users[userIndex].xp = users[userIndex].xp || users[userIndex].exp;
  users[userIndex].nextLevelExp = users[userIndex].nextLevelExp || users[userIndex].expToNextLevel;
  users[userIndex].workoutsCompleted = users[userIndex].workoutsCompleted || users[userIndex].trainingCount;
  users[userIndex].hunterName = users[userIndex].hunterName || users[userIndex].name;
  users[userIndex].profilePic = users[userIndex].profilePic || users[userIndex].profilePhoto;
  
  // Update localStorage - CRITICAL: Save both users array and currentUser
  localStorage.setItem('users', JSON.stringify(users));
  localStorage.setItem('currentUser', JSON.stringify(users[userIndex])); // Save updated user data
  
  // Refresh UI
  loadUserData();
  setTimeout(() => {
    loadLeaderboard(); // Delay to ensure data is saved
  }, 500);
  alert('Workout completed! XP awarded!');
}

// Load leaderboard
function loadLeaderboard() {
  // Get users from localStorage
  const usersJson = localStorage.getItem('users');
  console.log('Raw users JSON from localStorage:', usersJson);
  
  let users = [];
  if (usersJson) {
    try {
      users = JSON.parse(usersJson);
      console.log('Parsed users array:', users);
    } catch (e) {
      console.error('Error parsing users JSON:', e);
      users = [];
    }
  } else {
    console.log('No users found in localStorage');
  }
  
  const tbody = document.getElementById('leaderboardBody');
  
  console.log('Total users in localStorage:', users.length);
  
  // Normalize user data with more comprehensive checks
  const normalizedUsers = users.map((user, index) => {
    console.log(`Processing user ${index}:`, user);
    
    const normalizedUser = {...user};
    
    // Ensure all required fields exist
    normalizedUser.xp = (user.xp !== undefined && user.xp !== null) ? Number(user.xp) : 
                       (user.exp !== undefined && user.exp !== null) ? Number(user.exp) : 0;
    normalizedUser.workoutsCompleted = (user.workoutsCompleted !== undefined && user.workoutsCompleted !== null) ? Number(user.workoutsCompleted) :
                                      (user.trainingCount !== undefined && user.trainingCount !== null) ? Number(user.trainingCount) : 0;
    normalizedUser.level = (user.level !== undefined && user.level !== null) ? Number(user.level) : 1;
    normalizedUser.hunterName = user.hunterName || user.name || `User${index}`;
    normalizedUser.profilePic = user.profilePic || user.profilePhoto || null;
    
    console.log(`Normalized user ${index}:`, normalizedUser);
    return normalizedUser;
  });
  
  // Show all registered users sorted by XP
  const allUsers = normalizedUsers
    .filter(user => user.email && user.hunterName) // Users with email and hunter name
    .sort((a, b) => (b.xp || 0) - (a.xp || 0)); // Sort by XP descending
  
  console.log('Filtered and sorted users for leaderboard:', allUsers);
  
  // Clear the table
  tbody.innerHTML = '';
  
  if (allUsers.length === 0) {
    console.log('No valid users found for leaderboard');
    tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; color: #777; padding: 30px;">No users have logged in yet<br>Create an account to appear here!</td></tr>';
    return;
  }
  
  // Populate the leaderboard
  allUsers.forEach((user, index) => {
    console.log('Creating leaderboard row for user:', user);
    
    const row = document.createElement('tr');
    
    // Handle profile picture
    let profilePicHtml = '<div style="width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(45deg, var(--accent-blue), var(--accent-purple)); display: flex; align-items: center; justify-content: center; border: 2px solid var(--accent-blue); font-size: 20px;">üë§</div>';
    
    if (user.profilePic && typeof user.profilePic === 'string' && user.profilePic.length > 0 && 
        user.profilePic !== 'undefined' && user.profilePic !== 'null' && 
        user.profilePic !== 'data:' && !user.profilePic.startsWith('data:,') && 
        user.profilePic !== ' ') {
      // Valid profile picture found
      profilePicHtml = `<div style="width: 40px; height: 40px; border-radius: 50%; background-image: url('${user.profilePic}'); background-size: cover; background-position: center; border: 2px solid var(--accent-blue);"></div>`;
    }
    
    const rank = index + 1;
    const hunterName = user.hunterName || user.name || 'Anonymous User';
    const rankText = getRankByXP(user.xp || 0);
    const xp = user.xp || 0;
    const workouts = user.workoutsCompleted || 0;
    
    row.innerHTML = `
      <td class="rank-cell">#${rank}</td>
      <td>
        <div style="display: flex; align-items: center; gap: 10px;">
          ${profilePicHtml}
          <div>
            <div style="font-weight: 600;">${hunterName}</div>
          </div>
        </div>
      </td>
      <td>${rankText}</td>
      <td style="font-weight: bold; color: var(--accent-gold);">${xp}</td>
      <td>${workouts}</td>
    `;
    
    tbody.appendChild(row);
  });
  
  console.log('Leaderboard updated with', allUsers.length, 'users');
}

// Profile management
function openProfileModal() {
  document.getElementById('profileModal').style.display = 'flex';
  const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
  document.getElementById('hunterNameInput').value = currentUser.hunterName || '';
  
  if (currentUser.profilePic && currentUser.profilePic.length > 0 && 
      currentUser.profilePic !== 'undefined' && currentUser.profilePic !== 'null') {
    document.getElementById('uploadPreview').style.backgroundImage = `url('${currentUser.profilePic}')`;
    document.getElementById('uploadPreview').style.backgroundSize = 'cover';
    document.getElementById('uploadPreview').style.backgroundPosition = 'center';
    document.getElementById('uploadPreview').textContent = '';
  }
}

function closeProfileModal() {
  document.getElementById('profileModal').style.display = 'none';
}

function previewImage(event) {
  const file = event.target.files[0];
  if (file) {
    const reader = new FileReader();
    reader.onload = function(e) {
      document.getElementById('uploadPreview').style.backgroundImage = `url(${e.target.result})`;
      document.getElementById('uploadPreview').textContent = '';
    };
    reader.readAsDataURL(file);
  }
}

// Save profile with improved data synchronization
function saveProfile() {
  const hunterName = document.getElementById('hunterNameInput').value.trim();
  const profilePic = document.getElementById('uploadPreview').style.backgroundImage;
  
  if (!hunterName) {
    alert('Please enter your hunter name');
    return;
  }
  
  if (!profilePic || profilePic === 'none') {
    alert('Please upload a profile picture');
    return;
  }
  
  const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
  const users = JSON.parse(localStorage.getItem('users') || '[]');
  
  // Extract the actual data URI from the CSS url() format
  let profilePicData = profilePic;
  if (profilePic.startsWith('url(')) {
    // Remove url(" from start and ") from end
    profilePicData = profilePic.replace(/^url\(["']?/, '').replace(/["']?\)$/, '');
  }
  
  // Create updated user object with all current data
  const updatedUser = {
    ...currentUser,
    hunterName: hunterName,
    profilePic: profilePicData,
    // Ensure all data fields are preserved
    xp: currentUser.xp || currentUser.exp || 0,
    level: currentUser.level || 1,
    currentExp: currentUser.currentExp || 0,
    nextLevelExp: currentUser.nextLevelExp || currentUser.expToNextLevel || 100,
    workoutsCompleted: currentUser.workoutsCompleted || currentUser.trainingCount || 0,
    streak: currentUser.streak || 0,
    lastTrainedDate: currentUser.lastTrainedDate || null,
    todayTrainings: currentUser.todayTrainings || [],
    email: currentUser.email,
    id: currentUser.id || Date.now().toString()
  };
  
  // Update the users array - find the user by email and update
  const userIndex = users.findIndex(u => u.email === currentUser.email);
  if (userIndex !== -1) {
    // Replace the entire user object to ensure all data is preserved
    users[userIndex] = updatedUser;
  } else {
    // If user not found in array, add them (shouldn't happen in normal flow)
    users.push(updatedUser);
  }
  
  // CRITICAL: Save both arrays to localStorage
  try {
    localStorage.setItem('users', JSON.stringify(users));
    localStorage.setItem('currentUser', JSON.stringify(updatedUser));
    
    // Also update the UI immediately
    document.getElementById('hunterName').textContent = hunterName;
    const profilePicElement = document.getElementById('profilePicture');
    profilePicElement.style.backgroundImage = profilePic;
    profilePicElement.style.backgroundSize = 'cover';
    profilePicElement.style.backgroundPosition = 'center';
    profilePicElement.textContent = '';
    
    closeProfileModal();
    loadLeaderboard(); // Refresh leaderboard to show changes
    
    alert('Profile updated successfully!');
  } catch (e) {
    console.error('Error saving profile:', e);
    alert('Error saving profile. Storage may be full.');
  }
}

function checkProfileCompletion() {
  const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
  // Only prompt for profile completion if they haven't set a hunter name
  if (!currentUser.hunterName) {
    setTimeout(() => {
      openProfileModal();
    }, 1000);
  }
}

// Logout function
function logout() {
  if (confirm('Are you sure you want to logout?')) {
    // Before logging out, ensure all data is saved to the users array
    const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
    const users = JSON.parse(localStorage.getItem('users') || '[]');
    
    if (currentUser.email) {
      // Update the user in the users array before logging out
      const userIndex = users.findIndex(u => u.email === currentUser.email);
      if (userIndex !== -1) {
        users[userIndex] = currentUser;
        localStorage.setItem('users', JSON.stringify(users));
      }
    }
    
    // Now remove currentUser and redirect
    localStorage.removeItem('currentUser');
    window.location.href = 'index.html';
  }
}

// Permanent account deletion function
function deleteAccount() {
  const confirmation = confirm('‚ö†Ô∏è PERMANENT ACCOUNT DELETION WARNING ‚ö†Ô∏è\n\nThis action cannot be undone!\n\nYour profile, progress, XP, workouts, and all data will be permanently deleted.\n\nTo confirm deletion, type "DELETE MY ACCOUNT" in the box below:');
  
  if (!confirmation) {
    return; // User canceled
  }
  
  // Ask user to type confirmation text
  const confirmationText = prompt('Type "DELETE MY ACCOUNT" to confirm permanent deletion:');
  
  if (confirmationText !== "DELETE MY ACCOUNT") {
    alert('Account deletion cancelled. Confirmation text did not match.');
    return;
  }
  
  // Get current user
  const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
  
  if (!currentUser.email) {
    alert('No account found to delete.');
    return;
  }
  
  // Remove user from the users array
  let users = JSON.parse(localStorage.getItem('users') || '[]');
  users = users.filter(user => user.email !== currentUser.email);
  localStorage.setItem('users', JSON.stringify(users));
  
  // Clear current user session
  localStorage.removeItem('currentUser');
  
  alert('Your account has been permanently deleted. All your data is gone forever.');
  
  // Redirect to homepage
  window.location.href = 'index.html';
}

// Workout Tracker Variables
let workoutInterval;
let workoutStartTime;
let totalDistance = 0;
let totalCalories = 0;
let totalSteps = 0;
let isWorkoutActive = false;
let isWorkoutPaused = false;
let workoutSessions = [];
let watchId = null;
let currentPosition = null;
let previousPosition = null;
let map = null;
let polyline = null;
let markers = [];
// Toggle workout tracker modal
function toggleWorkoutTracker() {
  const modal = document.getElementById('workoutTrackerModal');
  if (modal.style.display === 'none' || modal.style.display === '') {
    modal.style.display = 'block';
    loadPreviousSessions();
    initializeGoogleMap();
  } else {
    modal.style.display = 'none';
    if (isWorkoutActive) {
      stopWorkout();
    }
    // Stop location tracking when modal closes
    if (watchId) {
      navigator.geolocation.clearWatch(watchId);
      watchId = null;
    }
  }
}

























// Get location permission
function getLocationPermission() {
  if (!navigator.geolocation) {
    alert('Geolocation is not supported by your browser');
    return;
  }
  
  // Request permission and show map
  navigator.geolocation.getCurrentPosition(
    function(position) {
      initializeGoogleMap();
      document.getElementById('getLocationBtn').style.display = 'none';
    },
    function(error) {
      alert('Location access denied. Please enable location services.');
    }
  );
}

// Initialize Google Map
function initializeGoogleMap() {
  if (typeof google === 'undefined' || !navigator.geolocation) return;
  
  // Get current position
  navigator.geolocation.getCurrentPosition(function(position) {
    const userLocation = {
      lat: position.coords.latitude,
      lng: position.coords.longitude
    };
    
    // Show Google Map container
    document.getElementById('mapPlaceholder').style.display = 'none';
    document.getElementById('googleMapContainer').style.display = 'block';
    
    // Initialize map
    map = new google.maps.Map(document.getElementById('googleMapContainer'), {
      zoom: 16,
      center: userLocation,
      mapTypeId: 'terrain',
      styles: [
        { featureType: 'poi', elementType: 'labels', stylers: [{ visibility: 'off' }] },
        { featureType: 'transit', elementType: 'labels', stylers: [{ visibility: 'off' }] }
      ]
    });
    
    // Add user marker
    new google.maps.Marker({
      position: userLocation,
      map: map,
      title: 'You are here',
      icon: {
        path: google.maps.SymbolPath.CIRCLE,
        scale: 8,
        fillColor: '#4CAF50',
        fillOpacity: 1,
        strokeColor: '#ffffff',
        strokeWeight: 2
      }
    });
    
    currentPosition = userLocation;
    previousPosition = userLocation;
    
  }, function(error) {
    console.log('Error getting location:', error);
  });
}

// Start workout with location tracking
function startWorkout() {
  if (isWorkoutActive) return;
  
  if (!navigator.geolocation) {
    alert('Location services required for workout tracking');
    return;
  }
  
  isWorkoutActive = true;
  isWorkoutPaused = false;
  workoutStartTime = Date.now();
  
  // Show pause and stop buttons
  document.getElementById('startBtn').style.display = 'none';
  document.getElementById('pauseBtn').style.display = 'block';
  document.getElementById('stopBtn').style.display = 'block';
  
  // Start timer and tracking
  workoutInterval = setInterval(updateWorkoutStats, 1000);
  
  // Start location tracking
  watchId = navigator.geolocation.watchPosition(
    updateLocation,
    function(error) {
      console.log('Location error:', error);
    },
    {
      enableHighAccuracy: true,
      maximumAge: 10000,
      timeout: 5000
    }
  );
}

// Update location during workout
function updateLocation(position) {
  if (!isWorkoutActive || isWorkoutPaused) return;
  
  const newLocation = {
    lat: position.coords.latitude,
    lng: position.coords.longitude
  };
  
  currentPosition = newLocation;
  
  // Calculate distance between points
  if (previousPosition) {
    const distance = calculateDistance(
      previousPosition.lat, previousPosition.lng,
      newLocation.lat, newLocation.lng
    );
    
    totalDistance += distance;
    
    // Update step count (approx 2000 steps per km)
    const newSteps = Math.floor(distance * 2000);
    totalSteps += newSteps;
    
    // Update map
    updateGoogleMapRoute(previousPosition, newLocation);
  }
  
  previousPosition = newLocation;
}

// Calculate distance between two coordinates (in km)
function calculateDistance(lat1, lon1, lat2, lon2) {
  const R = 6371; // Earth's radius in km
  const dLat = (lat2 - lat1) * Math.PI / 180;
  const dLon = (lon2 - lon1) * Math.PI / 180;
  const a = 
    Math.sin(dLat/2) * Math.sin(dLat/2) +
    Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
    Math.sin(dLon/2) * Math.sin(dLon/2);
  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
  return R * c;
}

// Update Google Map with route
function updateGoogleMapRoute(from, to) {
  if (!map) return;
  
  // Create or update polyline
  if (!polyline) {
    polyline = new google.maps.Polyline({
      path: [from, to],
      geodesic: true,
      strokeColor: '#4CAF50',
      strokeOpacity: 1.0,
      strokeWeight: 4
    });
    polyline.setMap(map);
  } else {
    const path = polyline.getPath();
    path.push(to);
  }
  
  // Update map center
  map.setCenter(to);
}

// Pause workout
function pauseWorkout() {
  if (!isWorkoutActive) return;
  
  if (isWorkoutPaused) {
    // Resume
    isWorkoutPaused = false;
    workoutStartTime = Date.now() - (totalDistance * 1000); // Adjust start time
    workoutInterval = setInterval(updateWorkoutStats, 1000);
    document.getElementById('pauseBtn').textContent = 'PAUSE';
  } else {
    // Pause
    isWorkoutPaused = true;
    clearInterval(workoutInterval);
    document.getElementById('pauseBtn').textContent = 'RESUME';
  }
}

// Stop workout
function stopWorkout() {
  if (!isWorkoutActive) return;
  
  clearInterval(workoutInterval);
  isWorkoutActive = false;
  isWorkoutPaused = false;
  
  // Save session
  const session = {
    date: new Date().toISOString(),
    duration: document.getElementById('timer').textContent,
    distance: parseFloat(document.getElementById('distance').textContent),
    calories: parseInt(document.getElementById('calories').textContent),
    pace: document.getElementById('pace').textContent
  };
  
  workoutSessions.push(session);
  saveWorkoutSessions();
  
  // Reset UI
  document.getElementById('startBtn').style.display = 'block';
  document.getElementById('pauseBtn').style.display = 'none';
  document.getElementById('stopBtn').style.display = 'none';
  document.getElementById('pauseBtn').textContent = 'PAUSE';
  
  // Reset stats
  resetWorkoutStats();
  loadPreviousSessions();
  
  alert(`Workout completed!\nDistance: ${session.distance} km\nCalories: ${session.calories}\nDuration: ${session.duration}`);
}

// Update workout statistics
function updateWorkoutStats() {
  if (isWorkoutPaused) return;
  
  const elapsed = (Date.now() - workoutStartTime) / 1000; // seconds
  const hours = Math.floor(elapsed / 3600);
  const minutes = Math.floor((elapsed % 3600) / 60);
  const seconds = Math.floor(elapsed % 60);
  
  // Update timer
  document.getElementById('timer').textContent = 
    `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
  
  // Update distance (now from actual GPS)
  document.getElementById('distance').textContent = totalDistance.toFixed(2);
  
  // Update calories (rough estimate)
  totalCalories = Math.floor(totalDistance * 60); // 60 calories per km
  document.getElementById('calories').textContent = totalCalories;
  
  // Update pace
  if (totalDistance > 0) {
    const paceMin = Math.floor((elapsed / 60) / totalDistance);
    const paceSec = Math.floor(((elapsed / 60) / totalDistance - paceMin) * 60);
    document.getElementById('pace').textContent = `${paceMin}:${paceSec.toString().padStart(2, '0')}`;
  }
  
  // Update steps
  document.getElementById('steps').textContent = totalSteps;
}

// Reset workout stats
function resetWorkoutStats() {
  clearInterval(workoutInterval);
  if (watchId) {
    navigator.geolocation.clearWatch(watchId);
    watchId = null;
  }
  totalDistance = 0;
  totalCalories = 0;
  totalSteps = 0;
  document.getElementById('timer').textContent = '00:00:00';
  document.getElementById('distance').textContent = '0.00';
  document.getElementById('calories').textContent = '0';
  document.getElementById('pace').textContent = '0:00';
  document.getElementById('steps').textContent = '0';
  
  // Reset map
  if (polyline) {
    polyline.setMap(null);
    polyline = null;
  }
  currentPosition = null;
  previousPosition = null;
}


// Load previous sessions
function loadPreviousSessions() {
  const sessions = JSON.parse(localStorage.getItem('workoutSessions') || '[]');
  const container = document.getElementById('previousSessions');
  
  if (sessions.length === 0) {
    container.innerHTML = '<div style="text-align: center; color: #777; padding: 20px;">No previous sessions recorded</div>';
    return;
  }
  
  container.innerHTML = sessions.map(session => `
    <div style="background: rgba(255,255,255,0.1); padding: 10px; margin: 5px 0; border-radius: 5px; border-left: 3px solid var(--accent-green);">
      <div style="display: flex; justify-content: space-between; font-size: 14px;">
        <div>üìÖ ${new Date(session.date).toLocaleDateString()}</div>
        <div>‚è±Ô∏è ${session.duration}</div>
      </div>
      <div style="display: flex; justify-content: space-between; margin-top: 5px;">
        <div>üèÉ ${session.distance} km</div>
        <div>üî• ${session.calories} cal</div>
        <div>‚ö° ${session.pace}/km</div>
      </div>
    </div>
  `).join('');
}

// Save workout sessions
function saveWorkoutSessions() {
  localStorage.setItem('workoutSessions', JSON.stringify(workoutSessions));
  
  // Update user's workout count in main stats
  let currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
  if (currentUser.email) {
    const sessions = JSON.parse(localStorage.getItem('workoutSessions') || '[]');
    currentUser.workoutsCompleted = sessions.length;
    
    // Update localStorage
    localStorage.setItem('currentUser', JSON.stringify(currentUser));
    
    // Update users array
    const users = JSON.parse(localStorage.getItem('users') || '[]');
    const userIndex = users.findIndex(u => u.email === currentUser.email);
    if (userIndex !== -1) {
      users[userIndex] = currentUser;
      localStorage.setItem('users', JSON.stringify(users));
    }
    
    // Update display
    document.getElementById('workoutsCompleted').textContent = sessions.length;
  }
}

// Initialize workout tracker
function initWorkoutTracker() {
  workoutSessions = JSON.parse(localStorage.getItem('workoutSessions') || '[]');
  loadPreviousSessions();
}

// Exercise guide modal
function showExerciseGuide(exerciseName) {
  const guide = getExerciseGuide(exerciseName);
  
  // Create modal
  const modal = document.createElement('div');
  modal.className = 'modal';
  modal.style.display = 'flex';
  modal.innerHTML = `
    <div class="modal-content" style="max-width: 600px;">
      <span class="close-modal" onclick="this.closest('.modal').remove()">&times;</span>
      <h2 style="color: var(--accent-blue); margin-bottom: 20px;">${exerciseName} Guide</h2>
      <div style="color: #ddd; line-height: 1.6;">
        <h3 style="color: var(--accent-gold); margin: 15px 0 10px;">Proper Form:</h3>
        <p>${guide.form}</p>
        
        <h3 style="color: var(--accent-gold); margin: 15px 0 10px;">Tips:</h3>
        <p>${guide.tips}</p>
        
        <h3 style="color: var(--accent-gold); margin: 15px 0 10px;">Common Mistakes:</h3>
        <p>${guide.mistakes}</p>
        
        <h3 style="color: var(--accent-gold); margin: 15px 0 10px;">Benefits:</h3>
        <p>${guide.benefits}</p>
      </div>
      <button onclick="this.closest('.modal').remove()" style="width: 100%; padding: 15px; background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple)); border: none; border-radius: 8px; color: white; font-weight: bold; cursor: pointer; margin-top: 20px;">GOT IT!</button>
    </div>
  `;
  
  document.body.appendChild(modal);
}

function getExerciseGuide(exerciseName) {
  const guides = {
    'Push-ups': {
      form: 'Start in plank position with hands slightly wider than shoulders. Keep body straight from head to heels. Lower chest to floor, then push back up.',
      tips: 'Engage core, keep elbows at 45-degree angle, breathe out on push-up.',
      mistakes: 'Letting hips sag, flaring elbows too wide, not going low enough.',
      benefits: 'Strengthens chest, shoulders, triceps, and core muscles.'
    },
    'Squats': {
      form: 'Stand with feet hip-width apart. Lower body by bending knees and pushing hips back as if sitting in chair. Keep chest up and knees aligned with toes.',
      tips: 'Drive through heels, keep weight in heels, go as low as comfortable.',
      mistakes: 'Knees caving in, leaning too far forward, not going deep enough.',
      benefits: 'Strengthens legs, glutes, and improves mobility.'
    },
    'Sit-ups': {
      form: 'Lie on back with knees bent and feet flat. Place hands behind head or across chest. Lift shoulders off ground using abdominal muscles.',
      tips: 'Engage core throughout the movement, exhale on the way up.',
      mistakes: 'Pulling on neck, using momentum, not engaging abs.',
      benefits: 'Strengthens abdominal muscles and core stability.'
    },
    'Jumping Jacks': {
      form: 'Start with feet together and arms at sides. Jump feet apart while raising arms overhead, then jump back to start position.',
      tips: 'Land softly on balls of feet, maintain rhythm, breathe steadily.',
      mistakes: 'Landing too hard, poor arm coordination.',
      benefits: 'Improves cardiovascular endurance and coordination.'
    },
    'Plank': {
      form: 'Start in push-up position but rest on forearms. Keep body straight from head to heels, engage core.',
      tips: 'Squeeze glutes and abs, do not let hips sag or rise too high.',
      mistakes: 'Sagging hips, raising butt too high, holding breath.',
      benefits: 'Strengthens core, shoulders, and improves stability.'
    },
    'Running': {
      form: 'Maintain upright posture, land mid-foot under your center of gravity, keep arms relaxed at 90-degree angle.',
      tips: 'Start slow and gradually increase pace, stay hydrated, focus on breathing rhythm.',
      mistakes: 'Overstriding, hunching shoulders, looking down.',
      benefits: 'Improves cardiovascular health, burns calories, boosts endurance.'
    },
    'Burpees': {
      form: 'Start standing, drop into squat position, kick feet back into plank, do push-up, jump feet forward, stand and jump up.',
      tips: 'Maintain steady rhythm, land softly, engage core throughout.',
      mistakes: 'Poor form to rush through, not going deep enough on squat.',
      benefits: 'Full-body workout, improves strength and cardiovascular fitness.'
    }
  };
  
  return guides[exerciseName] || {
    form: 'Follow proper form and technique for this exercise.',
    tips: 'Start with modified versions if needed.',
    mistakes: 'Focus on proper form over speed.',
    benefits: 'Builds strength and endurance.'
  };
}

// Complete Training function
function startCompleteTraining() {
  const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
  const users = JSON.parse(localStorage.getItem('users') || '[]');
  
  // Find user in users array
  const userIndex = users.findIndex(u => u.email === currentUser.email);
  if (userIndex === -1) return;
  
  // Check training limit
  const currentRank = getCurrentRankInfo(currentUser.xp || 0);
  const rankIndex = ranks.findIndex(rank => rank.name === currentRank.name);
  const aRankIndex = ranks.findIndex(rank => rank.name === 'A-RANK');
  
  const today = new Date().toDateString();
  
  // Initialize todayTrainings array if not exists
  if (!users[userIndex].todayTrainings) {
    users[userIndex].todayTrainings = [];
  }
  
  // Count today's trainings
  const todayTrainings = users[userIndex].todayTrainings.filter(date => date === today).length;
  
  let maxTrainings = 2; // Default for A-Rank and below
  if (rankIndex > aRankIndex) { // B-Rank and above
    maxTrainings = 4;
  }
  
  if (todayTrainings >= maxTrainings) {
    const rankName = rankIndex > aRankIndex ? 'B-Rank and above' : 'A-Rank and below';
    alert(`You have reached your daily training limit (${maxTrainings} trainings per day for ${rankName}).\nTrainings completed today: ${todayTrainings}/${maxTrainings}`);
    return;
  }
  
  // Award XP for complete training
  const xpGain = 10;
  users[userIndex].xp = (users[userIndex].xp || 0) + xpGain;  // Changed from || 100 to || 0
  
  // Update workouts completed
  users[userIndex].workoutsCompleted = (users[userIndex].workoutsCompleted || 0) + 1;
  
  // Add today's training
  users[userIndex].todayTrainings.push(today);
  
  // Update streak
  const lastTrained = users[userIndex].lastTrainedDate;
  if (lastTrained && new Date(lastTrained).toDateString() === new Date(Date.now() - 86400000).toDateString()) {
    // Consecutive day
    users[userIndex].streak = (users[userIndex].streak || 0) + 1;
  } else if (!lastTrained || new Date(lastTrained).toDateString() !== today) {
    // New day
    users[userIndex].streak = (users[userIndex].streak || 0) + 1;
  }
  
  users[userIndex].lastTrainedDate = today;
  users[userIndex].lastTrained = new Date().toISOString();
  
  // Check for level up
  const level = users[userIndex].level || 1;
  const currentExp = users[userIndex].currentExp || 0;
  const expToNext = level * 100;
  
  if (currentExp + xpGain >= expToNext) {
    users[userIndex].level = level + 1;
    users[userIndex].currentExp = (currentExp + xpGain) - expToNext;
    alert(`üéâ LEVEL UP! You are now Level ${users[userIndex].level}!`);
  } else {
    users[userIndex].currentExp = currentExp + xpGain;
  }
  
  // Ensure data normalization
  users[userIndex].xp = users[userIndex].xp || users[userIndex].exp;
  users[userIndex].nextLevelExp = users[userIndex].nextLevelExp || users[userIndex].expToNextLevel;
  users[userIndex].workoutsCompleted = users[userIndex].workoutsCompleted || users[userIndex].trainingCount;
  users[userIndex].hunterName = users[userIndex].hunterName || users[userIndex].name;
  users[userIndex].profilePic = users[userIndex].profilePic || users[userIndex].profilePhoto;
  
  // Update localStorage - CRITICAL: Save both users array and currentUser
  localStorage.setItem('users', JSON.stringify(users));
  localStorage.setItem('currentUser', JSON.stringify(users[userIndex])); // Save updated user data
  
  // Refresh UI
  loadUserData();
  loadLeaderboard();
  updateTrainingLimitInfo();
  
  alert(`Training completed! +${xpGain} XP earned!\nTrainings today: ${todayTrainings + 1}/${maxTrainings}`);
}

// Update training limit info display
function updateTrainingLimitInfo() {
  const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
  const users = JSON.parse(localStorage.getItem('users') || '[]');
  
  // Find user in users array
  const userIndex = users.findIndex(u => u.email === currentUser.email);
  if (userIndex === -1) return;
  
  const currentRank = getCurrentRankInfo(currentUser.xp || 0);
  const rankIndex = ranks.findIndex(rank => rank.name === currentRank.name);
  const aRankIndex = ranks.findIndex(rank => rank.name === 'A-RANK');
  
  const today = new Date().toDateString();
  
  // Initialize todayTrainings array if not exists
  if (!users[userIndex].todayTrainings) {
    users[userIndex].todayTrainings = [];
  }
  
  // Count today's trainings
  const todayTrainings = users[userIndex].todayTrainings.filter(date => date === today).length;
  
  let maxTrainings = 2; // Default for A-Rank and below
  let rankName = 'A-Rank and below';
  if (rankIndex > aRankIndex) { // B-Rank and above
    maxTrainings = 4;
    rankName = 'B-Rank and above';
  }
  
  const limitInfo = document.getElementById('trainingLimitInfo');
  if (limitInfo) {
    limitInfo.textContent = `Daily Limit: ${todayTrainings}/${maxTrainings} trainings (${rankName})`;
    
    // Change color based on usage
    if (todayTrainings >= maxTrainings) {
      limitInfo.style.color = 'var(--accent-red)';
    } else if (todayTrainings >= maxTrainings - 1) {
      limitInfo.style.color = 'var(--accent-gold)';
    } else {
      limitInfo.style.color = '#aaa';
    }
  }
}

// Initialize on page load
document.addEventListener('DOMContentLoaded', initApp);
</script>

</body>
</html>
